import{r as c,j as e,k as N,w as b}from"./index-BQwJztVw.js";import{L as R}from"./index-BGRuDrHz.js";import{O as w}from"./OrdersTable-BkaQiVO-.js";function k(t=[],u=600,s=()=>{}){let a=0,l=null,i=u;function o(){if(!t||t.length===0){s([]);return}n(),l=setInterval(()=>{if(a++,a>t.length){n();return}s(t.slice(0,a))},i)}function n(){l&&(clearInterval(l),l=null)}function r(){n(),a=0,s([])}function m(p){i=p,l&&(n(),o())}return{start:o,stop:n,reset:r,setSpeed:m}}function C({equityData:t=[]}){const u=c.useRef([]),s=c.useRef(null),[a,l]=c.useState([]),[i,o]=c.useState(600);c.useEffect(()=>{if(!Array.isArray(t)||t.length===0){u.current=[],l([]),s.current&&s.current.reset();return}return u.current=t.map(r=>({x:r.date??r.time??r.timestamp??"",y:Number(r.equity??r.close??r.value??0)})),l([]),s.current=k(u.current,i,r=>l(r)),()=>{s.current&&s.current.stop()}},[t]),c.useEffect(()=>{s.current&&s.current.setSpeed(i)},[i]);const n={labels:a.map(r=>r.x),datasets:[{label:"Equity (replay)",data:a.map(r=>r.y),borderColor:"#60a5fa",backgroundColor:"rgba(96,165,250,0.06)",pointRadius:0,tension:.2,fill:!0}]};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"px-3 py-2 rounded bg-emerald-500 text-white",onClick:()=>s.current&&s.current.start(),children:"Play"}),e.jsx("button",{className:"px-3 py-2 rounded bg-rose-500 text-white",onClick:()=>s.current&&s.current.stop(),children:"Pause"}),e.jsx("button",{className:"px-3 py-2 rounded bg-gray-700 text-white",onClick:()=>{s.current&&s.current.reset(),l([])},children:"Reset"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("label",{children:"Speed"}),e.jsxs("select",{value:i,onChange:r=>o(Number(r.target.value)),className:"bg-[#071018] p-2 rounded text-white",children:[e.jsx("option",{value:1e3,children:"1x"}),e.jsx("option",{value:600,children:"2x"}),e.jsx("option",{value:300,children:"4x"}),e.jsx("option",{value:150,children:"8x"})]})]})]}),e.jsx("div",{className:"glass-card p-4",style:{height:360},children:e.jsx(R,{data:n,options:{maintainAspectRatio:!1}})})]})}function L(){var p,y,f,g,j,v;const{data:t,setData:u}=N(),[s,a]=c.useState(0),[l,i]=c.useState(!1),o=c.useRef(null),n=(p=t==null?void 0:t.equityData)!=null&&p.length?t.equityData:((f=(y=t==null?void 0:t.compare)==null?void 0:y[0])==null?void 0:f.equityData)??[],r=(g=t==null?void 0:t.orders)!=null&&g.length?t.orders:((v=(j=t==null?void 0:t.compare)==null?void 0:j[0])==null?void 0:v.orders)??[];c.useEffect(()=>(l?o.current=setInterval(()=>{a(d=>Math.min(n.length-1,d+1))},300):clearInterval(o.current),()=>clearInterval(o.current)),[l,n.length]),c.useEffect(()=>{function d(h){h.key===" "||h.key==="k"?i(x=>!x):h.key==="ArrowRight"?a(x=>Math.min(n.length-1,x+1)):h.key==="ArrowLeft"&&a(x=>Math.max(0,x-1))}return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[n.length]);const m=()=>{u(b),a(0)};return!n||n.length===0?e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Replay"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Replay equity & trades over time"})]}),e.jsx("div",{children:e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-emerald-600 text-white rounded text-sm",children:"Load Demo Replay"})})]}),e.jsx("div",{className:"glass-card p-4 text-gray-400 mt-6",children:"No equity series loaded â€” upload CSV in Compare or click Load Demo Replay."})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Replay"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Replay equity & trades over time"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(d=>!d),className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-sm",children:l?"Pause":"Play"}),e.jsx("button",{onClick:()=>{a(0),i(!1)},className:"px-3 py-1.5 border rounded text-sm",children:"Reset"}),e.jsx("button",{onClick:m,className:"px-3 py-1.5 bg-emerald-600 text-white rounded text-sm",children:"Load Demo"})]})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Replay (equity)"}),e.jsx(C,{equityData:n,currentIndex:s}),e.jsx("div",{className:"mt-3",children:e.jsx("input",{type:"range",min:0,max:Math.max(0,n.length-1),value:s,onChange:d=>a(Number(d.target.value)),className:"w-full"})})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Orders (during replay)"}),e.jsx(w,{orders:r})]})]})}export{L as default};
