import{k as $,r as b,j as t}from"./index-BQwJztVw.js";import{L as q,S as E}from"./index-BGRuDrHz.js";import"./lightweight-charts.production-D4lkRJ8h.js";import{E as _,h as H}from"./html2canvas.esm-C2Y9aXT0.js";function U(r=[]){const l=[];for(let a=1;a<r.length;a++){const n=Number(r[a-1].equity||0),i=Number(r[a].equity||0);l.push(n===0?0:(i-n)/n)}return l}function V(r=[],l=20){const a=[];for(let n=0;n<r.length;n++){const i=r.slice(Math.max(0,n-l+1),n+1);if(i.length<2)a.push(0);else{const x=i.reduce((p,f)=>p+f,0)/i.length,o=Math.sqrt(i.reduce((p,f)=>p+(f-x)**2,0)/i.length);a.push(o)}}return a}function z(r=[],l=[]){const a=Math.min(r.length,l.length);if(a<2)return 0;const n=r.slice(0,a),i=l.slice(0,a),x=d=>d.reduce((R,S)=>R+S,0)/d.length,o=x(n),p=x(i);let f=0,N=0,v=0;for(let d=0;d<a;d++)f+=(n[d]-o)*(i[d]-p),N+=(n[d]-o)**2,v+=(i[d]-p)**2;return f/Math.sqrt(N*v||1)}function I(r=[]){if(!r.length)return 0;const l=r.reduce((n,i)=>n+i,0)/r.length,a=Math.sqrt(r.reduce((n,i)=>n+(i-l)**2,0)/r.length);return a===0?0:l/a*Math.sqrt(252)}function W(r=[]){if(!r.length)return 0;const l=Number(r[0].equity||0),a=Number(r[r.length-1].equity||0);if(l<=0)return 0;const n=Math.max(1,r.length/252);return Math.pow(a/l,1/n)-1}function G(r=[]){let l=-1/0,a=0;for(const n of r){n>l&&(l=n);const i=(n-l)/l;i<a&&(a=i)}return a}function K(){const{data:r}=$(),a=(Array.isArray(r==null?void 0:r.compare)?r.compare:[]).filter(e=>e&&Array.isArray(e.equityData)&&e.equityData.length>0),n={equity:b.useRef(null),volatility:b.useRef(null),scatter:b.useRef(null),ranking:b.useRef(null),correlation:b.useRef(null)},i=["#60a5fa","#a78bfa","#fb7185","#34d399","#fbbf24","#fb923c"];if(a.length===0)return t.jsxs("div",{className:"p-6",children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"ComparePRO+"}),t.jsx("div",{className:"glass-card p-4 text-gray-400 mt-4",children:"No compare sets loaded. Upload 2+ CSVs or use Load Demo."})]});const x=a[0].equityData.map(e=>e.date),o=a.map(e=>U(e.equityData)),p=o.map(e=>V(e,20)),f=a.map((e,s)=>I(o[s])),N=a.map(e=>W(e.equityData)),v=a.map(e=>G(e.equityData.map(s=>s.equity))),d=a.map(e=>{var s;return((s=e.kpis)==null?void 0:s.win_rate)??0}),R=a.map((e,s)=>a.map((m,g)=>z(o[s],o[g]))),S={datasets:a.map((e,s)=>{const m=o[s].reduce((h,u)=>h+u,0)/Math.max(1,o[s].length),g=p[s].reduce((h,u)=>h+u,0)/Math.max(1,p[s].length);return{label:e.name||`Set ${s+1}`,data:[{x:g,y:m}],backgroundColor:i[s%i.length],pointRadius:6}})},k={labels:x,datasets:a.map((e,s)=>({label:e.name||`Set ${s+1}`,data:e.equityData.map(m=>Number(m.equity||0)),borderColor:i[s%i.length],pointRadius:0,tension:.25,fill:!1}))},M={labels:x.slice(1),datasets:a.map((e,s)=>({label:e.name||`Set ${s+1}`,data:p[s],borderColor:i[s%i.length],pointRadius:0,tension:.2,fill:!1}))},w=a.map((e,s)=>({name:e.name||`Set ${s+1}`,sharpe:f[s],cagr:N[s],maxDD:v[s],winRate:d[s]})).sort((e,s)=>s.sharpe-e.sharpe),P=()=>{const e=[];e.push(["strategy","cagr","sharpe","max_dd","win_rate"]);for(const c of w)e.push([c.name,c.cagr,c.sharpe,c.maxDD,c.winRate]);e.push([]);const s=["date",...a.map(c=>c.name)];e.push(s);for(let c=0;c<x.length;c++){const y=[x[c]];for(let j=0;j<a.length;j++)y.push(a[j].equityData[c]?a[j].equityData[c].equity:"");e.push(y)}const m=e.map(c=>c.map(y=>`"${String(y).replace(/"/g,'""')}"`).join(",")).join(`
`),g=new Blob([m],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(g),u=document.createElement("a");u.href=h,u.download=`comparepro_export_${Date.now()}.csv`,u.click(),URL.revokeObjectURL(h)},F=async()=>{const e=new _("p","mm","a4"),s=e.internal.pageSize.getWidth(),m=e.internal.pageSize.getHeight(),g=[{ref:n.equity,title:"Equity Curve Comparison"},{ref:n.volatility,title:"Rolling Volatility (20)"},{ref:n.scatter,title:"Risk-Return Scatter"},{ref:n.ranking,title:"Strategy Ranking"},{ref:n.correlation,title:"Correlation Matrix"}];for(let h=0;h<g.length;h++){const u=g[h].ref.current;if(!u)continue;const y=(await H(u,{scale:2,backgroundColor:"#06060a"})).toDataURL("image/png"),j=e.getImageProperties(y),C=s,A=j.height*C/j.width;h!==0&&e.addPage(),e.setFillColor(6,6,10),e.rect(0,0,s,20,"F"),e.setTextColor(255,255,255),e.setFontSize(12),e.text("QuantDash â€” ComparePRO+",10,13),e.setFontSize(8),e.text(`Generated: ${new Date().toLocaleString()}`,s-60,13);const D=22,L=m-D-10,O=Math.min(A,L);e.addImage(y,"PNG",0,D,C,O,void 0,"FAST")}e.save(`ComparePRO_Report_${Date.now()}.pdf`)};return t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"ComparePRO+"}),t.jsx("div",{className:"text-sm text-gray-400",children:"Advanced multi-metric strategy comparison"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:P,className:"px-3 py-1.5 bg-indigo-600 text-white rounded text-sm",children:"Export CSV"}),t.jsx("button",{onClick:F,className:"px-3 py-1.5 bg-emerald-600 text-white rounded text-sm",children:"Export Multi-page PDF"})]})]}),t.jsxs("div",{ref:n.equity,className:"glass-card p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"text-sm text-gray-400",children:"Equity Curve"}),t.jsxs("div",{className:"text-xs text-gray-500",children:[x.length," points"]})]}),t.jsx("div",{className:"h-72",children:t.jsx(q,{data:k,options:{maintainAspectRatio:!1}})})]}),t.jsxs("div",{ref:n.volatility,className:"glass-card p-4",children:[t.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Rolling Volatility (20)"}),t.jsx("div",{className:"h-56",children:t.jsx(q,{data:M,options:{maintainAspectRatio:!1}})})]}),t.jsxs("div",{ref:n.scatter,className:"glass-card p-4",children:[t.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Risk-Return Scatter"}),t.jsx("div",{className:"h-48",children:t.jsx(E,{data:S,options:{maintainAspectRatio:!1,plugins:{legend:{display:!0}}}})})]}),t.jsxs("div",{ref:n.ranking,className:"glass-card p-4",children:[t.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Strategy Ranking"}),t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{className:"text-gray-400 border-b border-[#111827]",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 text-left",children:"Strategy"}),t.jsx("th",{className:"py-2 text-right",children:"CAGR"}),t.jsx("th",{className:"py-2 text-right",children:"Sharpe"}),t.jsx("th",{className:"py-2 text-right",children:"Max DD"}),t.jsx("th",{className:"py-2 text-right",children:"Win %"})]})}),t.jsx("tbody",{children:w.map((e,s)=>t.jsxs("tr",{className:"border-b border-[#111827]",children:[t.jsx("td",{className:"py-2",children:e.name}),t.jsxs("td",{className:"py-2 text-right",children:[(e.cagr*100).toFixed(2),"%"]}),t.jsx("td",{className:"py-2 text-right",children:e.sharpe.toFixed(2)}),t.jsxs("td",{className:"py-2 text-right text-red-400",children:[(e.maxDD*100).toFixed(2),"%"]}),t.jsxs("td",{className:"py-2 text-right text-green-400",children:[(e.winRate*100).toFixed(1),"%"]})]},s))})]})]}),t.jsxs("div",{ref:n.correlation,className:"glass-card p-4",children:[t.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Correlation Matrix"}),t.jsx("div",{className:"grid gap-2",children:R.map((e,s)=>t.jsx("div",{className:"flex gap-2",children:e.map((m,g)=>t.jsx("div",{className:"p-3 rounded text-center",style:{width:64,height:40,backgroundColor:`rgba(96,165,250,${Math.min(.95,Math.abs(m))})`,color:"#0b1220",display:"flex",alignItems:"center",justifyContent:"center"},children:m.toFixed(2)},g))},s))})]})]})}export{K as default};
