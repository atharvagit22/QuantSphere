import{k as f,r as x,j as e,x as j}from"./index-BQwJztVw.js";import{L as v}from"./index-BGRuDrHz.js";function y(a){const i=[];for(let r=1;r<a.length;r++){const n=a[r-1].equity||0,c=a[r].equity||0;i.push(n===0?0:(c-n)/n)}return i}function N(a){const i=Array.from({length:a},()=>Math.random()),r=i.reduce((n,c)=>n+c,0);return i.map(n=>n/r)}function b(a,i=200){if(!a||a.length===0)return[];const r=a.length,n=a[0].length,c=[];for(let p=0;p<i;p++){const l=N(r),d=new Array(n).fill(0);for(let t=0;t<n;t++){let s=0;for(let m=0;m<r;m++)s+=(a[m][t]||0)*l[m];d[t]=s}const o=d.reduce((t,s)=>t+s,0)/d.length,h=d.reduce((t,s)=>t+(s-o)**2,0)/d.length,u=Math.sqrt(h),g=u===0?0:o/u;c.push({weights:l,ret:o,risk:u,sharpe:g})}return c.sort((p,l)=>p.risk-l.risk)}function k(a){return!a||a.length===0?null:a.reduce((i,r)=>r.sharpe>((i==null?void 0:i.sharpe)??-1/0)?r:i)}function w(){const{data:a,setData:i}=f(),r=a.compare||[],[n,c]=x.useState(500),[p]=x.useState(()=>Math.floor(Math.random()*1e5)),l=x.useMemo(()=>(r||[]).map((t,s)=>({id:t.id??`set${s+1}`,name:t.name??`Set ${s+1}`,equityData:t.equityData||[],kpis:t.kpis||{},orders:t.orders||[],trades:(t.orders||[]).length})),[r]),d=x.useMemo(()=>!l||l.length===0?[]:l.map(t=>y(t.equityData||[])),[l]),o=x.useMemo(()=>!d||d.length===0?[]:b(d,n),[d,n,p]),h=x.useMemo(()=>k(o),[o]),u=x.useMemo(()=>!o||o.length===0?{labels:[],datasets:[]}:{labels:o.map((t,s)=>s+1),datasets:[{label:"Frontier (ret)",data:o.map(t=>t.ret),borderColor:"#60a5fa",pointRadius:2,tension:.2},{label:"Frontier (risk)",data:o.map(t=>t.risk),borderColor:"#7c3aed",pointRadius:2,tension:.2}]},[o]),g=()=>{i(t=>({...t||{},compare:j}))};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Portfolio Optimizer"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Sampled efficient frontier using uploaded compare sets"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Samples"}),e.jsx("input",{type:"number",value:n,onChange:t=>c(Number(t.target.value||100)),className:"w-20 px-2 py-1 rounded bg-[#071018] border"}),e.jsx("button",{onClick:g,className:"px-3 py-1.5 bg-emerald-600 text-white rounded text-sm",children:"Load Demo Data"})]})]}),l.length===0?e.jsx("div",{className:"glass-card p-4 text-gray-400",children:'Upload multiple CSVs in Compare to enable optimizer or click "Load Demo Data".'}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Efficient frontier (sampled portfolios)"}),e.jsx("div",{style:{height:300},children:e.jsx(v,{data:u,options:{maintainAspectRatio:!1}})})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Best portfolio (max Sharpe)"}),h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-300 mb-3",children:["Sharpe: ",(h.sharpe||0).toFixed(4)]}),e.jsx("div",{className:"space-y-2",children:h.weights.map((t,s)=>{var m;return e.jsxs("div",{className:"flex justify-between text-sm text-gray-200",children:[e.jsx("div",{children:((m=l[s])==null?void 0:m.name)??`Set ${s+1}`}),e.jsxs("div",{className:"font-medium",children:[(t*100).toFixed(2),"%"]})]},s)})})]}):e.jsx("div",{className:"text-gray-400",children:"No best portfolio found"})]})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Underlying sets"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:l.map(t=>{var s;return e.jsxs("div",{className:"p-3 bg-[#071018] rounded",children:[e.jsx("div",{className:"text-sm text-gray-300 font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Trades: ",t.trades]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Win rate: ",((((s=t.kpis)==null?void 0:s.win_rate)??0)*100).toFixed(1),"%"]})]},t.id)})})]})]})]})}export{w as default};
